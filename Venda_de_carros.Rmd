---
title: "Venda de carros"
author: "Prof. MSc. Edgar Luiz de Lima"
date: "21/03/2022"
output:
  pdf_document: default
  html_document: default
---

# Preparação dos dados para as análises exploratórias

Definindo diretório e carregando os pacotes necessários.
```{r}
setwd("C:\\Users\\Edgar\\OneDrive - unb.br\\Venda_de_carros\\Venda_de_Carros")
library(openxlsx)
library(tidyverse)
```


Carregando e visualizando os dados.
```{r}
dados<- read.xlsx("DadosVendaCarros.xlsx")
View(dados)
str(dados)
```


Construindo o conjunto de dados para avaliar o total de vendas por ano. Irei preparar também um conjunto de dados do total de vendas por ano para a marca Jaguar.
```{r}
# Criando a matriz com o número de vendas por ano para todas as marcas.
TVanos<- data.frame(table(dados$Ano))
names(TVanos)<- c("Ano","Total")

# Criando a matriz do número de vendas por ano do carros da marca Jaguar.
TVAjaguar<- dados%>%filter(Fabricante=="Jaguar")%>%
  select(Ano)%>%table()%>%data.frame()
names(TVAjaguar)<- c("Ano","Total")

#Juntando em um mesmo dataframe
vanuais<-rbind.data.frame(TVanos,TVAjaguar)
vanuais<- rep(c("Total","Jaguar"), each= 4)%>%data.frame(vanuais)
names(vanuais)<- c("Escala","Ano","Total")
```

Checando a estrutura dos dados
```{r}
str(vanuais)
```

Transformando Escala em fator e ano em numérico.
```{r}
vanuais$Escala<- as.factor(vanuais$Escala)
vanuais$Ano<- as.numeric(as.character(vanuais$Ano))
str(vanuais)
```

Gerando o conjunto de dados do custo de entrega de veículos por fabricante.
```{r}
entrega<- dados%>%filter(Ano==2019)%>% select(Fabricante,ValorCusto)%>% group_by(Fabricante)%>%
  summarise(valor_entrega= mean(ValorCusto))
entrega$Fabricante<- as.factor(entrega$Fabricante)
View(entrega)
```


Gerando o conjunto de dados do custo de mão de obra por estado.
```{r}
mobra<- dados%>%filter(Ano==2019)%>%select(Estado,CustoMaoDeObra)%>% group_by(Estado)%>%
  summarise(Media_MaoDeObra= mean(CustoMaoDeObra))
View(mobra)
```

Conjunto de dados para avaliar o lucro de cada marca, iremos analizar apenas com dados de 2019.
```{r}
dluc<- dados%>%filter(Ano==2019)%>%
  select(Fabricante,Modelo,ValorVenda, ValorCusto)

gluc<- dluc%>%group_by(Fabricante)%>% summarise(Mvendas= mean(ValorVenda, na.rm= T), Mcusto= mean(ValorCusto, na.rm= T))

lucro<- gluc%>%mutate(lucro= Mvendas - Mcusto)
lucro<- arrange(lucro,desc(lucro))
View(lucro)
```

# Análise gráfica dos dados

Analise gráfica do padrão temporal de vendas.
```{r}
ggplot(vanuais, aes(Ano, Total,colour= Escala))+
  geom_line(size= 1)+
  geom_point(size= 4)+
  scale_y_continuous(limits = c(10,240), breaks = seq(10,240,20))+
  annotate("text", x = vanuais$Ano, y =vanuais$Total+11, 
           label = vanuais$Total, size= 5)+
  ylab("Total de vendas")+
  theme_bw()+
  theme(panel.grid= element_blank(), axis.title = element_text(size= 16),
        axis.text = element_text(size= 14, color = "black"), legend.title= element_blank(),
        legend.text = element_text(size = 14))
```


Gráfico do custo de entrega por fabricante
```{r}
ggplot(entrega, aes(Fabricante, valor_entrega))+
  geom_col(fill="black")+
  annotate("text", x =entrega$Fabricante, y =entrega$valor_entrega+3000, 
           label = round(entrega$valor_entrega, 2), size= 4)+
  ylab("Valor de entrega")+
  xlab("Fabricante")+
  theme_bw()+
  theme(panel.grid= element_blank(), axis.title = element_text(size= 16),
        axis.text = element_text(size= 14, color = "black"), legend.title= element_blank(),
        legend.text = element_text(size = 12))
```


Gráfico da mão de obra por estado.
```{r}
ggplot(mobra, aes(Estado, Media_MaoDeObra))+
  geom_col(fill="black")+
  coord_flip()+
  annotate("text", x =mobra$Estado, y =mobra$Media_MaoDeObra+80, 
          label =round(mobra$Media_MaoDeObra,2), size= 4)+
  scale_y_continuous(limits = c(0,1200), breaks = seq(0,1200,150))+
  ylab("Valor de entrega")+
  xlab("Fabricante")+
  theme_bw()+
  theme(panel.grid= element_blank(), axis.title = element_text(size= 16),
        axis.text = element_text(size= 14, color = "black"), legend.title= element_blank(),
        legend.text = element_text(size = 12))
```

Grafico com o lucro de cada marca.
```{r}
ggplot(lucro, aes(Fabricante, lucro))+
  geom_col(fill= "black")+
  coord_flip()+
  ylab("Lucro")+
  xlab("Fabricante")+
  theme_bw()+
  theme(panel.grid= element_blank(), axis.title = element_text(size= 16),
        axis.text = element_text(size= 14, color = "black"), legend.title= element_blank(),
        legend.text = element_text(size = 12))
```


